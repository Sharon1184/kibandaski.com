dy>
    </html>
<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Food Detail</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      getDoc,
      doc,
      setDoc,
      updateDoc,
      arrayUnion
    } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";const firebaseConfig = {
  apiKey: "AIzaSyAHhmbgDA_D13LcnEWgtr5Unu7uihBpGPE",
  authDomain: "food-ae7ff.firebaseapp.com",
  projectId: "food-ae7ff",
  storageBucket: "food-ae7ff.appspot.com",
  messagingSenderId: "1058214228504",
  appId: "1:1058214228504:web:f1f059be00c9aeaf7cc96d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let cartId = localStorage.getItem("cartId");
if (!cartId) {
  cartId = "cart_" + Math.random().toString(36).substring(2);
  localStorage.setItem("cartId", cartId);
}

const params = new URLSearchParams(window.location.search);
const foodName = params.get("name")?.toLowerCase();
let currentFood = null;
let allFoods = [];

const loadFoods = async () => {
  const querySnapshot = await getDocs(collection(db, "foods"));
  allFoods = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

  const matches = allFoods.filter(f => f.name.toLowerCase() === foodName);
  if (matches.length === 0) {
    document.getElementById("food-title").innerText = "Food not found.";
    return;
  }
  displayMainFood(matches[0]);
  displayVariants(matches);
};

const displayMainFood = (food) => {
  currentFood = food;
  document.getElementById("food-img").src = food.imageUrl;
  document.getElementById("food-title").innerText = food.name;
  document.getElementById("food-desc").innerText = food.description;
  document.getElementById("food-price").innerText = "Ksh. " + food.price;
};

const displayVariants = (foods) => {
  const variantsDiv = document.getElementById("variants");
  variantsDiv.innerHTML = "";
  foods.forEach(food => {
    const div = document.createElement("div");
    div.style.minWidth = "150px";
    div.style.marginRight = "10px";
    div.style.cursor = "pointer";
    div.innerHTML = `
      <img src="${food.imageUrl}" style="width:100%; border-radius:8px" />
      <p style="text-align:center;"><strong>${food.restaurant}</strong><br>Ksh. ${food.price}</p>
    `;
    div.addEventListener("click", () => displayMainFood(food));
    variantsDiv.appendChild(div);
  });
};

const addToCart = async () => {
  if (!currentFood) return;
  const cartRef = doc(db, "carts", cartId);
  const cartSnap = await getDoc(cartRef);

  if (cartSnap.exists()) {
    await updateDoc(cartRef, {
      items: arrayUnion(currentFood)
    });
  } else {
    await setDoc(cartRef, {
      items: [currentFood]
    });
  }

  alert("âœ… Added to cart!");
  updateCartCount();
};

const updateCartCount = async () => {
  const cartRef = doc(db, "carts", cartId);
  const cartSnap = await getDoc(cartRef);
  let count = 0;
  if (cartSnap.exists()) {
    count = cartSnap.data().items?.length || 0;
  }
  let badge = document.querySelector(".cart-badge");
  if (!badge) {
    badge = document.createElement("sup");
    badge.classList.add("cart-badge");
    document.querySelector(".cart").appendChild(badge);
  }
  badge.innerText = count;
};

window.addEventListener("DOMContentLoaded", () => {
  loadFoods();
  document.getElementById("add-to-cart-btn").addEventListener("click", addToCart);
  updateCartCount();
});

  </script>
  <style>
    .food-detail-container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      text-align: center;
    }
    .food-img {
      width: 100%;
      max-width: 400px;
      border-radius: 12px;
      object-fit: cover;
      margin-bottom: 20px;
    }
    #variants {
      display: flex;
      overflow-x: auto;
      padding-top: 20px;
    }
    .btn-primary, .btn-secondary {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px;
      transition: 0.3s ease;
    }
    .btn-primary {
      background-color: #27ae60;
      color: white;
    }
    .btn-secondary {
      background-color: #2980b9;
      color: white;
    }
  </style>
</head>
<body>
  <div class="food-detail-container">
    <img id="food-img" class="food-img" />
    <h1 id="food-title"></h1>
    <p id="food-desc"></p>
    <h3 id="food-price"></h3>
    <button id="add-to-cart-btn" class="btn-primary">Add to Cart</button>
    <button onclick="window.location.href='checkout.html'" class="btn-secondary">Proceed to Checkout</button>
    <div>
      <h3>Other restaurants offering this</h3>
      <div id="variants"></div>
    </div>
  </div>
</body>
</html>
